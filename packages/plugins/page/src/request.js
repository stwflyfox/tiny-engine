/* eslint-disable no-use-before-define */
/* eslint-disable no-console */
/* eslint-disable no-undef */
import axios from 'axios'


var BASE_URL;
var LoginInfo;

var isLocal = location.href.toLowerCase().indexOf('localhost') >= 0 || location.href.indexOf('127.0.') >= 0
var app = GetQueryString('id')
switch (app) {
  case '14':
    BASE_URL = isLocal ?  "http://localhost:5006" : "https://to.91zd.cn"
    LoginInfo = "236CCF4C9C5C7041CC472B1BB846BF3E89F2E72BCDE1BCC6A1870BA50401BF33750DDD5BB7B5A74F6A934C9EAF6738538399B95F39FAF24FBA0E3F5E33E02BB5500636B5D8B97F8A9D6DB754EE0CE3B00A25D5F35D18B3FE71E9A246436F13F1CA5BE144B2BA5CEC0C46EDA38F8B25A89CF89094850B1EB926300846D5FD00F0C06BED48D3061B2C91BCA30051CCC7788330DCF023988F8312A579A0AD931A950B96BCB6A7351832471EA5EF351740335C2B6362B1E5CD868EAFB877E003C8AE7E0789AF9B0BD95428E2B368B6BEA6CB724054ED9A550645F078FC164329D4C219958750C33E9E604D80A28FDB6B50B1C697F5713EF3414694984180E95ED09AE15B10248D79EF1CAF8E99C78440745B80A844206D1B31A2391055E9F99627D08429A0BE764F9CDFFF463529714EC88DEEE9B4A2F451CADFD3424EC0B7A6E31A4EE31266AA0F2CCE7A873DF9D78E06CEB0E8014C52C4B23ABE807FC069E7BAFFB6EC2E1060141D078F6926919F6109F34BBA8062163E24C519A7C3CE0CCC71A71052C4573DA1A5B9FAF3E0D7350C3BB9999AF8FBA7F27FCB6E43BF4444E3E35E4ACCE1E927574439DD1046DE164327B1C488E222B9AE2311F5EB21D5E0CAF7F3F3F5E5DFD636995E5E01658CA9C9126555E6A002A1FAFCAF5040CA3189C5DD5EA5AB30DD2AE88D71901816EEAC7A2AAB4A3EDBB67FA02F26BD538E51FDD5E86F853D1DD35BC0DB1A6CBCFB276307A38E621A78D619BF86C97EEB2CFBC03D258AB7C55A40F4B33B478ECC9E6A47359188C58B722452AAE6DB7D91F1E8B33AA53FBA5F9B1570FF0E5EEF6CB0C463C979DF05A1ABA10E0B6C7DD280F4F7B838244C982E18F2DC8B33FC82281DD3C1D7D9A38CE8CDEC35CC99DED5E379011C975E0768B04677D00E4A83055BB0C360404416A11CAF7CCA8ADE1567C35060A8D325F69E12BB8549781396A255C2DF80D263E784934564F01AC6064B75B6BB596E1A5E4F831807D339FDA513CDAACB16674D01019BAA97EA507749122F78E8D712DEAA55BBAD8B1504DFBF9982EA32681D78B8B55AB6613143DB1DAC5DD3BA79C8D5763088B1EF8ED39A0DE470C8B9BFBF3CBDC6B543B6B67904EA3A683E54B41A7C820255ABF9D8B9C1D48CBC0A4F13FE1774E503561C3585D42EB003D575C7FB168FF02DC7243536033C5CC6C1CB3C7C465125BA7D6DA0A15AF4D5CC2AE4F1ACAE0CD78AFF12D8C89A790AD16EC37832887AEDF1317A2F4A2319E1631322B151068271D802CFD8573088DDCCD3A66B8BAE1B88F205598BEA1B3282B21D7BCCE67AF905BB61C8EF49FD891DB98882C4B8E5E025BBE4077048AC7FA38664A17B20A54BCFB80754D40027563AE967AA3718CB5AD62B3E02932EA0B14802D3E9EEE3EFC2E76B2097826C0F45708E7F38718351FA1BF3F38F0A29910EC792A0111E77541BAC6266267F207A21B2000FC5A5656AC7BF84F27768D2D12A544DD15D1B5884B2E7B51CA1BD32BCD34AC6B49DA0BC4081FF110A63DAC5D1AA90FF27C781BB6842F86290EF3FD1D649F3E57D6CB64B8E28ECFB72D34A72C0ADD18EEDD6B871949A282715245ABB796CF42886C242804533EAF933A79872438359E041C5E9504B2BF300C6AC8A875C9959DDCED30AA215020DA9CA7E3B63367527F511D64AD16414EA60CD28CB45A5E9000EF08ECFED8B55B7FE40F4A8F2509E1D640CD37EF141AC519DE169F5E8C8724B2764E919FD84311FF6596155D1C073EB135357A1B51DA2C593D2265F9ECD7FADC67C93842432DB929A1A7535EF38E1E2550FF3DF16DC2A1D4D3114122AAFFFD7FAEC09F283E512AF75F5BD63024E7A6881329514DF049D969638E30924CFB087B123C8854676282D1E08A2F7A41C26740A8218BE310C2753F2E72CF2BA35055B7F3067D90EEB44F1AF179C1623B1DAFBD10DC0F7F2FBD935B261CEB562388283E08DDBB225C2E460AD3608CA304F633AB75C21720EAA2F8430616FDBD7938BEF49480466ED01A58CD32A879FEAE180B7A15E546BFD491495852E04135458A89FF94916AD3BECEABAB583E8EEA33D71E8A76C85DA48E151949F427EBDF90ED353BF87927FCC634A2447816F25B827EE416E63E14E2886454C10F3B26249000D2786A48414BB442F185D948B90D835A16A4A04EF7FA0F7377BE5193135248ADD2F17F5BA35D1944952FFBC2001A2CA18B870DC30E5B5FFC4C6918DF6F11F2D79F6CCD8599551587BA512BB6DF703C5489417309EC4651068201B6C560A4361188EA226713F57CF457195268FC450FE10246FD5C6D8E40D6F80799A9F58AF8F38A3247AEADB00DA41584C8AE8A82E65E14AAADAB111F97A0DDDB476F33C38D3B71902A0A1C226C084B5FF71C88BDE7DB3E95A2456D093CC72CBA445283C69C1991BBE884937C027ECAECEB622B7BF7796671CD4C3475FC8202C72C92F6640D2980267D0F110F455CF682C27FB46A6F0712D897C2CFC2836B4F0617DDB859B94F9AAAFFADE6D89A5639BD13ABC13C89D192EF6EF5B6603235001F7EAF73BF86DE20DF6D1BC332E590478FD5F6E272ACF25422484C5BCB138EFE138DEEACF9A7FD1F000EFCBF9F653E73563C7A9EC17F759ABD41C42B31C4439258386A52CCD6BEBDF5B159F909FE27D688CF743498D9DD11F55616ADDD3C0DE209B2AA38B876EFCB3B896CFA250D106B5D9F80F89E63C5ED67B5C0B4EDF6518A601B01C9A5925E1B07FB282A71428E4AFACC6D2A9DA676D508845D89117AB2211D0ADAA90610636FDDECED2ECF2D78DC8323875F6707CCF3F5F3C9091F9A9E40A9D8EDB5DEC3FF2259533CCD4C4A1BBC65AD82F0B89E95213B035C5065884885FFE2A556B6EAB1972813DDE2801B70C228675981EE88228C41BC9CB6997932A4624C4B5475A6E93349558B42C9ECC64BDDEDB06B960909E39EA8B2C0701655DF5FEB679FCF75F91347F23BE26497BCE1B335E9F22A256A61D379A7B594475F067DBF6E4CB798C145AC4FA31140768664A9B10F1FEBB69EF527CCF11502836B0FB62EC29908288582EA77BE52D776D2579499FAD5F2139EA70DE72C80D7680CE399F5B910AD4A74D16BB29AC2E098B3BD596CE5F74F9B9335FEEB07B1B4760D32FFD6F9E344CFD66D20FBB870A0129EC3BC73D375ACA53092C7C62D9A69BA9F6F42A16B3E28E09514075CD862D23CFCAA88D5EB32081BC7D6EB9B3A384C4B82E78342E7D9F892342961D31DE147236350F8F457B43D0F0F981F3C0609538B036191AB7349FE656BA3E7AA1B736F342EB13F323BB2E2A8D15F62BA244184D359E3F0B1329911CF8AE53FF0CAED9C6381E60BE74EB4D764DC2CFE8D0D51FE6919DFF0BF17349E0490FC37324D19AF3C12D88388DF8A37CAE388AE56684A7034BFBF6CB36277A590AFDDE7ABC619F057AD0847FCE5F052EC8606C53E627A2A1EE27";
    break;
  default:
    BASE_URL = isLocal ?  "http://localhost:5005" : "https://wms3.91zd.cn"
    LoginInfo = isLocal ? "B9E93192FA20AECD8778D342DD0E707591D8BF15B04AB500D9AF85A847FD0BDA0F6C7876FF9C153E7FF74FA507740381CA137D71E8F0C0F21A92A5CE0A93B40833BF059236853B7A45F0F52B91C361375FF66BECD47A2108FB7F0237703BE0F13A34B58708FE86CC4859C282D8E4A9136F34EFA850D6A0355F118A0472AC0362F2F2D31C5592E15BFE4E27F850607AEF932ECD3B057114E281B0C29D80112141ED454608D64692D211D025F529C3E4E0A8C60D5BFA98CD0792A516B4BA2207A68D8FCECC972C9E62AB117A49590FA6BC59C9C788263869ECFBAD9A416152874FBFB22FE72EDA17F9EA6A69C3353390A0ABEA8A300DF31B2928076797099660F166CBC40F4B8293B0176561AA52EDFBAB52FA283E036ED6C0673DE7327356778F9F2A2573DF44D8444E9F861D09BE90CE2618668BA8BC920BA500941CC00DF98C192DBB0DABBC2AF92E46140096E91413D7F4D4E0FCBE92AE0BCA3CDA045A9BC554E42AA7128020C87D42A44B75AAD262C493C9AB6697E95AAC984308438386BD6DE446B8807573F013B9D6F325D24F5A3AC0B4F7D7CA6D898F9D6D94C13D72AD924273A9A9B18CAAC3925D88E471C44B9B048E668E021F64A58E0EE47BC20282275B2A7B74F219B9DE3A3E33FAA26923AF94BF5ADF6D5866E1E29BFBE340BA42FF7705D69B636A495F8145591CA49221636EDE940A134642FF347B75F53A1F293FE3DB79D79D8EF0AF7A63F9C14B66879845DF9C07D7F50CFAEDE9A5CE1E4BB72683293FE55475CADD7766C4D3643394A70B16FBD60269CEB939575B65A5ADE9E8DE41222F7211C1266F08F9806B6CA483657518F7089A83014205A9EC5DD216A46EB5DE7E21E437D307BEA0388C9676C8C2E1E25AE69CBF699CB8565F8699A0A48E23BFDBA728C67D248E9BC5E181EDD2D26CDBC244B5D274141C2DEC615426F37435E8F406AFB18D9E5961E77297ACBF7C9F6C267E2F5319DD6B899C885DCFB8D12CD40D57E534A07DF55AD19F18C26AACF55184B366C4E88043FBCAEEF8B0FF5337DFC5D6CBCEA226A41A8C16BD7CFCD400BE4300263FF86B3BE6588849B442FC66D18170AE109A5A093608CB374433379BCF646D5EA5293E0C6CD89DF42387E00BABE7AFAC664B5A4D72A15D8518D3588590D3D21DC091FB70FC03AFB34982DCD095F3E4AF417FD6CFBA48DB8D5CA67E01A747EEF86975E6AE1B17B7E56ACFC89EE2583CBE365BD8DD466C0A5ED46D4771F98CDBC5D578E04FD56234554374A3EEAF788870DEF4AC0CDAFE5DC224BD02A0C2640CC7232B3B144F105A43225F280D252BC6FB75370FDB0D84F047B05243BD89970682455B744488CADF5383317FB91D850ECE457A3E04141439B0379112034C26BE9B2357F3ACD7008E4FCB36212D54CE7313C3EE3EC4A39CCEE049F05AAA6BC0D8F870282FE0D9CF662FF9AEB6771677F0E1252D4BEB21E7DD1AEB" 
: "B9E93192FA20AECD8778D342DD0E707591D8BF15B04AB500D9AF85A847FD0BDA0F6C7876FF9C153E7FF74FA507740381CA137D71E8F0C0F21A92A5CE0A93B40833BF059236853B7A45F0F52B91C361375FF66BECD47A2108FB7F0237703BE0F13A34B58708FE86CC4859C282D8E4A9136F34EFA850D6A0355F118A0472AC0362F2F2D31C5592E15BFE4E27F850607AEF932ECD3B057114E281B0C29D80112141ED454608D64692D211D025F529C3E4E0A8C60D5BFA98CD0792A516B4BA2207A68D8FCECC972C9E62AB117A49590FA6BC59C9C788263869ECFBAD9A416152874FBFB22FE72EDA17F9EA6A69C3353390A0ABEA8A300DF31B2928076797099660F166CBC40F4B8293B0176561AA52EDFBAB52FA283E036ED6C0673DE7327356778F9F2A2573DF44D8444E9F861D09BE90CE2618668BA8BC920BA500941CC00DF98C192DBB0DABBC2AF92E46140096E91413D7F4D4E0FCBE92AE0BCA3CDA045A9BC554E42AA7128020C87D42A44B75AAD262C493C9AB6697E95AAC984308438386BD6DE446B8807573F013B9D6F325D24F5A3AC0B4F7D7CA6D898F9D6D94C13D72AD924273A9A9B18CAAC3925D88E471C44B9B048E668E021F64A58E0EE47BC20282275B2A7B74F219B9DE3A3E33FAA26923AF94BF5ADF6D5866E1E29BFBE340BA42FF7705D69B636A495F8145591CA49221636EDE940A134642FF347B75F53A1F293FE3DB79D79D8EF0AF7A63F9C14B66879845DF9C07D7F50CFAEDE9A5CE1E4BB72683293FE55475CADD7766C4D3643394A70B16FBD60269CEB939575B65A5ADE9E8DE41222F7211C1266F08F9806B6CA483657518F7089A83014205A9EC5DD216A46EB5DE7E21E437D307BEA0388C9676C8C2E1E25AE69CBF699CB8565F8699A0A48E23BFDBA728C67D248E9BC5E181EDD2D26CDBC244B5D274141C2DEC615426F37435E8F406AFB18D9E5961E77297ACBF7C9F6C267E2F5319DD6B899C885DCFB8D12CD40D57E534A07DF55AD19F18C26AACF55184B366C4E88043FBCAEEF8B0FF5337DFC5D6CBCEA226A41A8C16BD7CFCD400BE4300263FF86B3BE6588849B442FC66D18170AE109A5A093608CB374433379BCF646D5EA5293E0C6CD89DF42387E00BABE7AFAC664B5A4D72A15D8518D3588590D3D21DC091FB70FC03AFB34982DCD095F3E4AF417FD6CFBA48DB8D5CA67E01A747EEF86975E6AE1B17B7E56ACFC89EE2583CBE365BD8DD466C0A5ED46D4771F98CDBC5D578E04FD562345543C27F4B672FA84654A376DDC0C798C9852A18727D13D80EF5CB0DE0B7C602FB3A5032A6629FFE700457EA38D5A1D0426E8AA3263D0FFB25C1FBA4477ADFF6F2EF28154DF28F15E92D0621049557F6F9A53437EFF584378872ACD3B8EE650BF1A6AB20728DF84367E359DEB077BDA2FD3CF1A33591B7FD72602FE56D08387C0916CD3D59B8E8CF27668233DF491C637606";
    break;
}

function GetQueryString(name) {
  var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
  var r = window.location.search.substr(1).match(reg);
  if (r != null) {
    return (decodeURIComponent(r[2]));
  }
  return null;
}

// 跨域认证信息 header 名
const xsrfHeaderName = 'Authorization'

axios.defaults.timeout = 1000 * 60 * 20 //20分钟
axios.defaults.withCredentials = true
axios.defaults.xsrfHeaderName = xsrfHeaderName
axios.defaults.xsrfCookieName = xsrfHeaderName

axios.defaults.headers.common = { // 针对所有axios发送的AJAX都添加的请求头    
  xsrfHeaderName: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJDb21wYW55Ijoic2hxeSIsIkFjY291bnQiOiJhZG1pbiIsImlzcyI6IjkxemQuY24iLCJhdWQiOiI5MXpkLmNuIn0.7w0deNde8-nVstfQ61-kXSSvKqvhvy-mCJCVMQ5erEI",
  'LoginInfo': LoginInfo,
  'Content-Type': 'application/json'
}

axios.interceptors.request.use(function (config) {
  // const cryptLoginInfo = sessionStorage.getItem("WMS3LoginInfo")


  // var token = getAuthorization();


  // if (token != undefined) {
  //   config.headers[xsrfHeaderName] = token;

  //   if (cryptLoginInfo != undefined) {
  //     config.headers['LoginInfo'] = cryptLoginInfo;
  //   }

  // }



  var showWaiting = false;


  // 

  //不显示提示
  try {
    if (config.data != undefined) {
      if (config.data.ShowWaiting != undefined && config.data.ShowWaiting == true) {
        showWaiting = true;
      }
    }
  } catch (err) { console.log(err) }


  if (showWaiting)
    layer.load(2, {
      shade: 0.01,
      content: '<span style="font-size:14px;padding-left:30px">正在处理中,请稍等...</span>',
      success: function (layero) {

        layero.find('.layui-layer-content').css({
          "position": 'fixed',
          "left": '-50px',
          "top": '-20px',
          'background-color': '#ffffff',
          'width': '220px',
          'height': '70px',
          'padding-top': '25px',
          'textAlign': 'center',
          'backgroundPositionX': '20px',
          'backgroundPositionY': '50%',
          "border": "1px silver solid",
          "vertical-align": "middle",

        });
      }
    });
  // }


  return config
}, function (error) {
  layer.closeAll('loading'); //关闭加载层

  if (error.response != undefined) {
    if (error.response.status == 401) {
      layer.alert(error.response.data.message, {
        title: '发生异常' + error.response.data.code,
        skin: 'layui-layer-molv'
      }, function () {
        logout();
      });
    } else {
      layer.alert(error.response.data.message + " " + error.config.url, {
        title: '发生异常' + error.response.data.code,
        skin: 'layui-layer-molv'
      });
    }
  } else {
    layer.alert('发生异常：' + error.message + " " + error.config.url, {
      title: '网络异常',
      skin: 'layui-layer-molv'
    })
  }
  return Promise.reject(error)
});

axios.interceptors.response.use(function (response) {
  layer.closeAll('loading'); //关闭加载层

  if (response.data && response.data.data)
  {
    return response.data.data;
  }
  else if (response.data)
  {
    return response.data;
  }
  else
  {
    return response 
  } 
}, function (error) {
  layer.closeAll('loading'); //关闭加载层

  if (error.response != undefined) {
    if (error.response.status == 401) {
      if (error.response.data.message != undefined) {
        layer.alert(error.response.data.message, {
          title: '发生异常' + error.response.data.code,
          skin: 'layui-layer-molv'
        }, function () {
          logout();
        });
      }
      else {
        layer.alert("接口未授权，将返回登录页!" + " " + error.config.url, {
          title: '发生异常',
          skin: 'layui-layer-molv'
        }, function () {
          logout();
        });
      }
    } else {
      layer.alert(error.response.data.message + " " + error.config.url, {
        title: '发生异常' + error.response.data.code,
        skin: 'layui-layer-molv'
      });
    }
  } else {
    layer.alert('发生异常：' + error.message + " " + error.config.url, {
      title: '网络异常',
      skin: 'layui-layer-molv'
    })
  }

  return Promise.reject(error)
})



// 认证类型
const AUTH_TYPE = {
  BEARER: 'Bearer',
  BASIC: 'basic',
  AUTH1: 'auth1',
  AUTH2: 'auth2',
}

// http method
const METHOD = {
  GET: 'get',
  POST: 'post'
}

/**
 * axios请求
 * @param url 请求地址
 * @param method {METHOD} http method
 * @param params 请求参数
 * @returns {Promise<AxiosResponse<T>>}
 */
async function request(url, method, params) {
  switch (method) {
    case METHOD.GET:
      return axios.get(BASE_URL + url, {
        params
      })
    case METHOD.POST:
      if (params)
        return axios.post(BASE_URL + url, params)
      else
        return axios.post(BASE_URL + url)
    default:
      return axios.get(BASE_URL + url, {
        params
      })
  }
}

/**
 * 设置认证信息
 * @param auth {Object}
 * @param authType {AUTH_TYPE} 认证类型，默认：{AUTH_TYPE.BEARER}
 */
function setAuthorization(auth, authType = AUTH_TYPE.BEARER) {
  switch (authType) {
    case AUTH_TYPE.BEARER:
      sessionStorage.setItem(xsrfHeaderName, "Bearer " + auth.token)
      break
    case AUTH_TYPE.BASIC:
    case AUTH_TYPE.AUTH1:
    case AUTH_TYPE.AUTH2:
    default:
      break
  }
}


//获取认证信息
function getAuthorization(authType = AUTH_TYPE.BEARER) {
  switch (authType) {
    case AUTH_TYPE.BEARER:
      return sessionStorage.getItem(xsrfHeaderName)
    case AUTH_TYPE.BASIC:
    case AUTH_TYPE.AUTH1:
    case AUTH_TYPE.AUTH2:
    default:
      break
  }
}

/**
 * 移出认证信息
 * @param authType {AUTH_TYPE} 认证类型
 */
function removeAuthorization(authType = AUTH_TYPE.BEARER) {
  switch (authType) {
    case AUTH_TYPE.BEARER:
      sessionStorage.removeItem(xsrfHeaderName)
      break
    case AUTH_TYPE.BASIC:
    case AUTH_TYPE.AUTH1:
    case AUTH_TYPE.AUTH2:
    default:
      break
  }
}

/**
 * 检查认证信息
 * @param authType
 * @returns {boolean}
 */
function checkAuthorization(authType = AUTH_TYPE.BEARER) {
  switch (authType) {
    case AUTH_TYPE.BEARER:
      if (sessionStorage.getItem(xsrfHeaderName)) {
        return true
      }
      break
    case AUTH_TYPE.BASIC:
    case AUTH_TYPE.AUTH1:
    case AUTH_TYPE.AUTH2:
    default:
      break
  }
  return false
}

/**
 * 加载 axios 拦截器
 * @param interceptors
 * @param options
 */
function loadInterceptors(interceptors, options) {
  const {
    request,
    response
  } = interceptors
  // 加载请求拦截器
  request.forEach(item => {
    let {
      onFulfilled,
      onRejected
    } = item
    if (!onFulfilled || typeof onFulfilled !== 'function') {
      onFulfilled = config => config
    }
    if (!onRejected || typeof onRejected !== 'function') {
      onRejected = error => Promise.reject(error)
    }
    axios.interceptors.request.use(
      config => onFulfilled(config, options),
      error => onRejected(error, options)
    )
  })
  // 加载响应拦截器
  response.forEach(item => {
    let {
      onFulfilled,
      onRejected
    } = item
    if (!onFulfilled || typeof onFulfilled !== 'function') {
      onFulfilled = response => response
    }
    if (!onRejected || typeof onRejected !== 'function') {
      onRejected = error => Promise.reject(error)
    }
    axios.interceptors.response.use(
      response => onFulfilled(response, options),
      error => onRejected(error, options)
    )
  })
}

/**
 * 解析 url 中的参数
 * @param url
 * @returns {Object}
 */
function parseUrlParams(url) {
  const params = {}
  if (!url || url === '' || typeof url !== 'string') {
    return params
  }
  const paramsStr = url.split('?')[1]
  if (!paramsStr) {
    return params
  }
  const paramsArr = paramsStr.replace(/&|=/g, ' ').split(' ')
  for (let i = 0; i < paramsArr.length / 2; i++) {
    const value = paramsArr[i * 2 + 1]
    params[paramsArr[i * 2]] = value === 'true' ? true : (value === 'false' ? false : value)
  }
  return params
}

export {
  METHOD,
  AUTH_TYPE,
  request,
  setAuthorization,
  removeAuthorization,
  checkAuthorization,
  loadInterceptors,
  parseUrlParams
}